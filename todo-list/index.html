<!DOCTYPE html>
<html>
<head>
	<title>Todo List</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" type="text/css" href="./realtime-search/style.css">
	<link rel="stylesheet" type="text/css" href="./todo-list/style.css">
	<link rel="stylesheet" type="text/css" href="./style.css">
</head>
<body>
<section>
	<article>
		<input 
		type="text" 
		placeholder="Type todo" 
		onkeydown="addTask(event)" 
		autofocus>
		<div class="tasks">

		</div>
	</article>
</section>
</body>
<script type="text/javascript" src="./todo-list/script.js"></script>
<script type="text/javascript" src="./script.js"></script>
</html>
<style type="text/css">
	article {
		width: 50%;
		margin: 10% auto;
	}
	article input {
		width: 100%;
		height: 50px;
		background-color: transparent;
		border: 0;
		font-family: 'Poppins','helvetica';
		font-size: 50px;
		text-align: center;
		color: grey;
		font-weight: bold;
	}

	.tasks {
		margin-top: 30px;
		width: 100%;
		text-align: center;
		color: grey;
		font-size: 20px;
	}
	.todo {
		cursor: pointer;
	}
	.todo.completed {
		text-decoration: line-through;
	}
</style>
<script type="text/javascript">
	const tasks = document.querySelector('.tasks')
	const ls = localStorage;
	window.onload = ()=>{
		// load todos
		const todos_ls = JSON.parse(ls.getItem('todos'));
		const todos = todos_ls.todos;

		for (var i = 0; i < todos.length; i++) {
			tasks.innerHTML += `
				<div 
					class="todo${ todos[i].completed ? ' completed':'' }" 
					onclick="done(event)"
					oncontextmenu="remove(event)"
				>${todos[i].todo}</div>
			`
		}
	}
	function addTask(e){
		if(e.keyCode == 13) {
			if (e.path[0].value != "") {
				tasks.innerHTML += `
					<div 
						class="todo" 
						onclick="done(event)"
						oncontextmenu="remove(event)"
					>${e.path[0].value}</div>
				`

				// add todo to localstorage
				const todos_ls = JSON.parse(ls.getItem('todos'))
				if (todos_ls == null ) {
					ls.setItem('todos', JSON.stringify({todos: [{
						todo: e.path[0].value, completed: false
					}]}))
				}else {
					todos_ls.todos.push({
						todo: e.path[0].value, completed: false
					})
					ls.setItem('todos', JSON.stringify(todos_ls))
				}
			
				e.path[0].value = "";
			}
		}
	}
	function done(e){
		e.path[0].classList.add('completed');
		// mention todo to be completed to localstorage
		const todos_ls = JSON.parse(ls.getItem('todos'));
		const todos = todos_ls.todos;
		
		for (var i = 0; i < todos.length; i++) {
			if (todos[i].todo == e.path[0].innerText) {
				todos[i].completed = true
			}else {
				continue;
			}

			ls.setItem('todos', JSON.stringify({todos}));
		}
	}
	function remove(e){
		e.path[0].remove();
		// remove todo to localstorage
		const todos_ls = JSON.parse(ls.getItem('todos'));
		const todos = todos_ls.todos;
		let ûpdated_todos = [];

		for (var i = 0; i < todos.length; i++) {
			if (todos[i].todo != e.path[0].innerText) {
				ûpdated_todos.push(todos[i])
			}else {
				continue;
			}

			ls.setItem('todos', JSON.stringify({todos: ûpdated_todos}));
		}
	}
</script>