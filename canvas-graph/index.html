<!DOCTYPE html>
<html>
<head>
	<title>Canvas Graph</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<section>
	<article>
		<canvas id="chart" width="1000" height="520"></canvas>
	</article>
</section>
</body>
<script type="text/javascript">
	const canvas = document.querySelector('#chart');
	const c = canvas.getContext('2d');
	const config = {
		canvasWidth: canvas.width,
		canvasHeight: canvas.height,
		barsColor: "rgb(220,53,69,.8)", // rgba(83,6,53,.8) rgb(220,53,69,.8) rgba(255,193,7,.8)
		lineWidth: 2,
		lineColor: "rgba(0,0,0,.5)",
		padding : 55,
		propreHeight: 0, // the height of the chart
		propreWidth: 0, // the width of the chart
	}

	// Set the height and the width of the chart without the padding that reserverd for chart labels
	config.propreHeight = config.canvasHeight - config.padding;
	config.propreWidth = config.canvasWidth - config.padding; 

	let YAxes = [/*{scale:11, y: 200}*/]

	const data = [
		{date: "01/02", scale: 220},
		{date: "02/02", scale: 210},
		{date: "03/02", scale: 250},
		{date: "04/02", scale: 225},
		{date: "05/02", scale: 199},
		{date: "06/02", scale: 244},
		{date: "07/02", scale: 265},
		{date: "08/02", scale: 214},
		{date: "09/02", scale: 200},
		{date: "10/02", scale: 222},
		{date: "11/02", scale: 260},
		{date: "12/02", scale: 280},
		{date: "13/02", scale: 160},
		{date: "14/02", scale: 110},
		{date: "15/02", scale: 115},
		{date: "16/02", scale: 155},
		{date: "17/02", scale: 121},
		{date: "18/02", scale: 122},
		{date: "19/02", scale: 120},
		{date: "20/02", scale: 205},
		{date: "21/02", scale: 125},
		{date: "22/02", scale: 152},
		{date: "23/02", scale: 270},

		{date: "24/02", scale: 356},
		{date: "25/02", scale: 125},
		{date: "26/02", scale: 130},
		{date: "27/02", scale: 156},
		{date: "28/02", scale: 171},
		{date: "29/02", scale: 200}
	];

	function createAxes() {

		// Y Axe 
		c.beginPath();
		c.lineWidth = config.lineWidth;
		c.strokeStyle = config.lineColor;
		c.moveTo(config.padding, config.padding); // from
		c.lineTo(config.padding, config.propreHeight); // to
		c.stroke();
		// X Axe
		c.beginPath();
		c.lineWidth = config.lineWidth;
		c.strokeStyle = config.lineColor;
		c.moveTo(config.padding, config.propreHeight); // from
		c.lineTo(config.propreWidth, config.propreHeight); // to
		c.stroke();

	}
	// Y Axies
	function createScalesY(){
		let divider = data.length - 1; /* How many X lines */
		let y = config.padding; // First X line's position
		let spaceBetweenXLines = (config.propreHeight - config.padding) / divider; // The space between two X lines in the Y Axe
		let getScaleValues = [];
		// Get the maximum scale
		data.forEach((scale)=>{ 
			getScaleValues.push(parseInt(scale.scale));
		})
		let scale = Math.max(...getScaleValues); // Start by the maximum scale in the Y Axe
		let scaleDifference = Math.floor(scale / divider); // Difference between two scales in the Y Axe 

		for (var i = 0; i < data.length; i++) {
			if (scale >= 0) {
				// line X
				c.beginPath();
				c.moveTo(config.padding, y); 
				c.lineTo(config.propreWidth, y);
				c.lineWidth = 1;
				c.strokeStyle = 'rgba(0,0,0,.2)';
				c.stroke();

				// Y Axe scale number
				c.fillText(scale, config.padding - 30, y/*Y*/)

				// Push to Y axes object to another use
				YAxes.push({
					scale: parseInt(scale),
					y: Math.floor(y)
				});

				// position the next Y line
				y += spaceBetweenXLines;

				// Next Y scale in the Axe
				scale -= scaleDifference;
			}
		}
	}
	function loadData(){
		const barWidth = (config.propreWidth - config.padding) / data.length;
		let   x = config.padding;
		let   y = 0;

		for (var i = 0; i < data.length; i++) {
			// const scale = (data[i].scale / config.propreHeight) * 100;

			// Returns the bar's height which is appropriate to the scale
			const scale = setBarHeight(parseInt(data[i].scale))

			// Set the Y position of the bar
			y = config.canvasHeight - scale - config.padding;
			// create Bar
			c.beginPath();
			c.lineWidth = 1;
			c.strokeStyle = "white";
			c.fillStyle = config.barsColor;
			c.fillRect(x, y, barWidth, scale);
			c.strokeRect(x, y, barWidth, scale);
			c.fill();

			// Put the label and Y line in the position
			createLabelsX(x, barWidth, data[i].date);
			// position the next bar
			x += barWidth;
		}

	}
	function setBarHeight(currentScale){
		let scaleY = 0;

		for (var i = 0; i < YAxes.length; i++) {
			if (currentScale <= YAxes[i].scale && currentScale >= YAxes[i+1].scale) {
				scaleY = config.propreHeight - YAxes[i].y;
			}
			else {
				continue;
			}
		}

		return scaleY;
	}
	// X axies
	function createLabelsX(x, barWidth, label) {
		// Put the label and Y line in the position
		const labelLinePosition = x + (barWidth / 2);
		const textPosition = x;
		// line Y
		c.beginPath();
		c.moveTo(labelLinePosition, config.propreHeight); 
		c.lineTo(labelLinePosition, config.propreHeight + 5/* 5 height of the small Y line*/);
		c.strokeStyle = config.lineColor;
		c.stroke();
		// text
		c.fillStyle = "black";
		c.font = "14px";
		c.fillText(label, textPosition, config.propreHeight + 17/*Y*/)
	}

	createScalesY();
	loadData();
	createAxes();
</script>
</html>